!function(){"use strict";const e="undefined"!=typeof window&&window.location.hostname.includes("localhost")?"http://localhost:5000":"https://api.morrisb.com";class t{constructor(e){e?(this.workspaceId=e,this.visitorId=this.getOrCreateVisitorId(),this.sessionId=this.getOrCreateSessionId(),this.eventQueue=[],this.flushTimer=null,this.trackPageView(),this.startFlushTimer(),"undefined"!=typeof window&&(window.addEventListener("beforeunload",()=>this.flush(!0)),window.addEventListener("visibilitychange",()=>{"hidden"===document.visibilityState&&this.flush(!0)}))):console.warn("[MorrisB] No workspace ID provided")}getOrCreateVisitorId(){try{let e=localStorage.getItem("mb_visitor_id");return e||(e=this.generateUUID(),localStorage.setItem("mb_visitor_id",e)),e}catch(e){return this.generateUUID()}}getOrCreateSessionId(){try{let e=sessionStorage.getItem("mb_session_id"),t=parseInt(sessionStorage.getItem("mb_last_activity")||"0");return(!e||Date.now()-t>18e5)&&(e=this.generateUUID(),sessionStorage.setItem("mb_session_id",e)),sessionStorage.setItem("mb_last_activity",Date.now().toString()),e}catch(e){return this.generateUUID()}}generateUUID(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){const t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)})}track(e,t,i={}){try{const r={workspaceId:this.workspaceId,visitorId:this.visitorId,sessionId:this.sessionId,eventType:e||"custom",eventName:t||"Event",url:window.location.href,referrer:document.referrer||void 0,properties:i,device:{userAgent:navigator.userAgent,screen:`${screen.width}x${screen.height}`,language:navigator.language},timestamp:(new Date).toISOString(),...this.getUTMParams()};this.eventQueue.push(r),this.eventQueue.length>=10&&this.flush()}catch(e){console.warn("[MorrisB] Track error:",e)}}trackPageView(){this.track("page_view","Page Viewed",{title:document.title,path:window.location.pathname})}trackClick(e,t={}){this.track("button_click","Button Clicked",{buttonText:e,...t})}trackFormView(e,t={}){this.track("form_view","Form Viewed",{formId:e,...t})}trackFormSubmit(e,t={}){this.track("form_submit","Form Submitted",{formId:e,...t})}identify(e,t={}){if(e)try{const i={workspaceId:this.workspaceId,visitorId:this.visitorId,email:e,properties:t};this.sendIdentify(i)}catch(e){console.warn("[MorrisB] Identify error:",e)}else console.warn("[MorrisB] Email required for identification")}async sendIdentify(t){try{const i=await fetch(`${e}/api/public/track/identify`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t),keepalive:!0});if(!i.ok)throw new Error(`Identify failed: ${i.statusText}`);const r=await i.json();console.log("[MorrisB] Visitor identified:",r)}catch(e){console.warn("[MorrisB] Identify request failed:",e)}}flush(t=!1){if(0!==this.eventQueue.length)try{const i=this.eventQueue.splice(0),r=JSON.stringify({events:i});t&&navigator.sendBeacon?navigator.sendBeacon(`${e}/api/public/track/event`,r):fetch(`${e}/api/public/track/event`,{method:"POST",headers:{"Content-Type":"application/json"},body:r,keepalive:!0}).catch(e=>{console.warn("[MorrisB] Flush error:",e)})}catch(e){console.warn("[MorrisB] Flush error:",e)}}startFlushTimer(){this.flushTimer&&clearInterval(this.flushTimer),this.flushTimer=setInterval(()=>{this.flush()},5e3)}getUTMParams(){try{const e=new URLSearchParams(window.location.search);return{utmSource:e.get("utm_source")||void 0,utmMedium:e.get("utm_medium")||void 0,utmCampaign:e.get("utm_campaign")||void 0,utmTerm:e.get("utm_term")||void 0,utmContent:e.get("utm_content")||void 0}}catch(e){return{}}}getVisitorId(){return this.visitorId}getSessionId(){return this.sessionId}}if(window.morrisb=function(e){return window._morrisb_instance&&window._morrisb_instance.workspaceId===e||(window._morrisb_instance=new t(e)),window._morrisb_instance},"undefined"!=typeof document){const e=document.currentScript;e&&e.dataset&&e.dataset.workspace&&window.morrisb(e.dataset.workspace)}}();