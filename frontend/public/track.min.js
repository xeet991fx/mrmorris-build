!function(){"use strict";const t="undefined"!=typeof window&&window.location.hostname.includes("localhost")?"http://localhost:5000":"https://api.clianta.online",e=[25,50,75,100],i={autoFormTracking:!0,autoIdentification:!0,scrollDepth:!0,timeOnPage:!0,engagement:!0,downloads:!0,exitIntent:!0,t:!0,utmTracking:!0,outboundLinks:!1,elementVisibility:!1,copyTracking:!1,i:!1,o:!1,errorTracking:!1,performanceTracking:!1};class n{constructor(e,n={}){e?(this.workspaceId=e,this.config={...i,...n},this.apiEndpoint=n.apiEndpoint||t,this.visitorId=this.h(),this.sessionId=this.l(),this.eventQueue=[],this.flushTimer=null,this.scrollDepthReached=new Set,this.pageLoadTime=Date.now(),this.clickHistory=[],this.trackedElements=new Set,this.maxScrollDepth=0,this.engagementStartTime=Date.now(),this.isEngaged=!1,this.formInteractions=new Map,this.trackedDownloads=new Set,this.exitIntentShown=!1,this.init()):console.warn("[MorrisB] No workspace ID provided")}init(){this.trackPageView(),this.startFlushTimer(),this.m(),this.config.scrollDepth&&this.setupScrollTracking(),this.config.engagement&&this.trackEngagement(),this.config.autoFormTracking&&this.setupFormTracking(),this.config.exitIntent&&!this.isMobile()&&this.setupExitIntent(),(this.config.downloads||this.config.outboundLinks)&&this.setupLinkTracking(),this.config.elementVisibility&&this.setupVisibilityTracking(),this.config.copyTracking&&this.u(),this.config.errorTracking&&this.setupErrorTracking(),this.config.performanceTracking&&this.trackPerformance()}m(){"undefined"!=typeof window&&(window.addEventListener("beforeunload",()=>{this.config.timeOnPage&&this.trackTimeOnPage(),this.flush(!0)}),window.addEventListener("visibilitychange",()=>{"hidden"===document.visibilityState?(this.config.timeOnPage&&this.trackTimeOnPage(),this.flush(!0)):this.engagementStartTime=Date.now()}),this.config.t&&document.addEventListener("click",t=>this.p(t),!0))}trackPageView(){const t={title:document.title,path:window.location.pathname,referrer:document.referrer||"direct",viewport:`${window.innerWidth}x${window.innerHeight}`,screenResolution:`${screen.width}x${screen.height}`};this.track("page_view","Page Viewed",t)}setupScrollTracking(){let t;window.addEventListener("scroll",()=>{clearTimeout(t),t=setTimeout(()=>this.trackScrollDepth(),150)},{passive:!0})}trackScrollDepth(){const t=window.innerHeight,i=document.documentElement.scrollHeight,n=window.pageYOffset||document.documentElement.scrollTop,s=Math.floor(n/(i-t)*100);s>this.maxScrollDepth&&(this.maxScrollDepth=s),e.forEach(t=>{s>=t&&!this.scrollDepthReached.has(t)&&(this.scrollDepthReached.add(t),this.track("scroll_depth",`Scrolled ${t}%`,{depth:t,timeToReach:Date.now()-this.pageLoadTime}))})}trackTimeOnPage(){const t=Math.floor((Date.now()-this.engagementStartTime)/1e3);t>0&&this.track("time_on_page","Time Spent",{seconds:t,maxScrollDepth:this.maxScrollDepth,engaged:this.isEngaged})}trackEngagement(){let t;const e=()=>{this.isEngaged||(this.isEngaged=!0,this.track("engagement","User Engaged",{timeToEngage:Date.now()-this.pageLoadTime})),clearTimeout(t),t=setTimeout(()=>{this.isEngaged=!1},3e4)};["mousemove","keydown","touchstart","scroll"].forEach(t=>{document.addEventListener(t,e,{passive:!0,once:!1})})}p(t){const e=t.target,i=Date.now();if(this.config.i||this.config.o){const n={x:t.clientX,y:t.clientY,timestamp:i,target:this.getElementInfo(e)};this.clickHistory.push(n),this.clickHistory.length>10&&this.clickHistory.shift(),this.config.i&&this.k(n),this.config.o&&this.T(e)}this.isTrackableElement(e)&&this.v(this.getElementText(e),{elementType:e.tagName.toLowerCase(),elementId:e.id,I:e.className,href:e.href})}k(t){const e=this.clickHistory.filter(e=>t.timestamp-e.timestamp<1e3);if(e.length>=3){e.every(e=>Math.sqrt(Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2))<50)&&this.track("rage_click","Rage Click Detected",{clicks:e.length,element:t.target})}}T(t){const e=t.onclick||t.getAttribute("onclick")||"pointer"===t.style.cursor;["A","BUTTON","INPUT","SELECT","TEXTAREA"].includes(t.tagName)||e||this.track("dead_click","Dead Click",{element:this.getElementInfo(t)})}setupFormTracking(){const t=()=>{document.querySelectorAll("form").forEach(t=>{if(t.dataset.mbTracked)return;t.dataset.mbTracked="true";const e=t.id||t.name||`form-${Math.random().toString(36).substr(2,9)}`;this.trackFormView(e,{action:t.action,method:t.method,_:t.elements.length}),Array.from(t.elements).forEach(t=>{t.name&&"submit"!==t.type&&"button"!==t.type&&["focus","blur","change"].forEach(i=>{t.addEventListener(i,()=>{const n=`${e}-${t.name}-${i}`;this.formInteractions.has(n)||(this.formInteractions.set(n,!0),this.track("form_interaction","Form Field Interaction",{formId:e,fieldName:t.name,fieldType:t.type,interactionType:i}))})})}),t.addEventListener("submit",i=>{if(this.trackFormSubmit(e,{action:t.action,method:t.method}),this.config.autoIdentification){const e=t.querySelector('input[type="email"], input[name*="email"]');if(e&&e.value){const i={email:e.value},n=t.querySelector('[name*="first"], [name*="fname"]'),s=t.querySelector('[name*="last"], [name*="lname"]'),o=t.querySelector('[name*="company"], [name*="organization"]'),r=t.querySelector('[type="tel"], [name*="phone"]');n&&(i.firstName=n.value),s&&(i.lastName=s.value),o&&(i.company=o.value),r&&(i.phone=r.value),this.identify(i.email,i)}}})})};if("loading"===document.readyState?document.addEventListener("DOMContentLoaded",t):t(),"undefined"!=typeof MutationObserver){new MutationObserver(()=>t()).observe(document.body,{childList:!0,subtree:!0})}}setupVisibilityTracking(){if("undefined"==typeof IntersectionObserver)return;const t=new IntersectionObserver(t=>{t.forEach(t=>{t.isIntersecting&&!this.trackedElements.has(t.target)&&(this.trackedElements.add(t.target),this.track("element_visible","Element Viewed",{element:this.getElementInfo(t.target),timeToView:Date.now()-this.pageLoadTime}))})},{threshold:.5});document.querySelectorAll(["button",'a[href*="contact"]','a[href*="signup"]','a[href*="demo"]','a[href*="trial"]',"[data-track-view]",".cta",".call-to-action"].join(", ")).forEach(e=>t.observe(e))}setupLinkTracking(){document.addEventListener("click",t=>{const e=t.target.closest("a");if(!e||!e.href)return;const i=e.href,n=window.location.hostname;if(this.config.downloads&&this.isDownloadLink(i)){const t=`download-${i}`;this.trackedDownloads.has(t)||(this.trackedDownloads.add(t),this.track("download","File Download",{url:i,filename:this.getFilename(i),fileType:this.getFileExtension(i),linkText:this.getElementText(e)}))}if(this.config.outboundLinks)try{const t=new URL(i).hostname;!t||t===n||i.startsWith("mailto:")||i.startsWith("tel:")||this.track("outbound_click","External Link Click",{url:i,domain:t,linkText:this.getElementText(e)})}catch(t){}},!0)}setupExitIntent(){document.addEventListener("mouseleave",t=>{t.clientY<=0&&!this.exitIntentShown&&(this.exitIntentShown=!0,this.track("exit_intent","Exit Intent Detected",{timeOnPage:Date.now()-this.pageLoadTime,scrollDepth:this.maxScrollDepth,engaged:this.isEngaged}))})}u(){document.addEventListener("copy",()=>{const t=window.getSelection().toString();t&&t.length>10&&this.track("copy","Content Copied",{length:t.length,preview:t.substring(0,100)})})}setupErrorTracking(){window.addEventListener("error",t=>{this.track("error","JavaScript Error",{message:t.message,filename:t.filename,line:t.lineno,column:t.colno})}),window.addEventListener("unhandledrejection",t=>{this.track("error","Unhandled Promise Rejection",{reason:t.reason?.toString()?.substring(0,200)})})}trackPerformance(){"undefined"!=typeof performance&&performance.timing&&window.addEventListener("load",()=>{setTimeout(()=>{const t=performance.timing,e=t.loadEventEnd-t.navigationStart,i=t.domContentLoadedEventEnd-t.navigationStart;this.track("performance","Page Performance",{loadTime:e,domReady:i})},0)})}track(t,e,i={}){try{const n={workspaceId:this.workspaceId,visitorId:this.visitorId,sessionId:this.sessionId,eventType:t||"custom",eventName:e||"Event",url:window.location.href,referrer:document.referrer||void 0,properties:i,device:{userAgent:navigator.userAgent,screen:`${screen.width}x${screen.height}`,language:navigator.language},timestamp:(new Date).toISOString()};this.config.utmTracking&&Object.assign(n,this.getUTMParams()),this.eventQueue.push(n),this.eventQueue.length>=10&&this.flush()}catch(t){console.warn("[MorrisB] Track error:",t)}}v(t,e={}){this.track("button_click","Button Clicked",{buttonText:t,...e})}trackFormView(t,e={}){this.track("form_view","Form Viewed",{formId:t,...e})}trackFormSubmit(t,e={}){this.track("form_submit","Form Submitted",{formId:t,...e})}identify(t,e={}){if(t)try{const i={workspaceId:this.workspaceId,visitorId:this.visitorId,email:t,properties:e};this.sendIdentify(i)}catch(t){console.warn("[MorrisB] Identify error:",t)}else console.warn("[MorrisB] Email required for identification")}async sendIdentify(t){try{const e=await fetch(`${this.apiEndpoint}/api/public/track/identify`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t),keepalive:!0});if(!e.ok)throw new Error(`Identify failed: ${e.statusText}`);const i=await e.json();console.log("[MorrisB] Visitor identified:",i)}catch(t){console.warn("[MorrisB] Identify request failed:",t)}}flush(t=!1){if(0!==this.eventQueue.length)try{const e=this.eventQueue.splice(0),i=JSON.stringify({events:e});if(t&&navigator.sendBeacon){const t=new Blob([i],{type:"application/json"});navigator.sendBeacon(`${this.apiEndpoint}/api/public/track/event`,t)}else fetch(`${this.apiEndpoint}/api/public/track/event`,{method:"POST",headers:{"Content-Type":"application/json"},body:i,keepalive:!0}).catch(t=>{console.warn("[MorrisB] Flush error:",t)})}catch(t){console.warn("[MorrisB] Flush error:",t)}}startFlushTimer(){this.flushTimer&&clearInterval(this.flushTimer),this.flushTimer=setInterval(()=>this.flush(),5e3)}h(){try{let t=localStorage.getItem("mb_visitor_id");return t||(t=this.generateUUID(),localStorage.setItem("mb_visitor_id",t)),t}catch(t){return this.generateUUID()}}l(){try{let t=sessionStorage.getItem("mb_session_id"),e=parseInt(sessionStorage.getItem("mb_last_activity")||"0");return(!t||Date.now()-e>18e5)&&(t=this.generateUUID(),sessionStorage.setItem("mb_session_id",t)),sessionStorage.setItem("mb_last_activity",Date.now().toString()),t}catch(t){return this.generateUUID()}}generateUUID(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){const e=16*Math.random()|0;return("x"===t?e:3&e|8).toString(16)})}getUTMParams(){try{const t=new URLSearchParams(window.location.search);return{utmSource:t.get("utm_source")||void 0,utmMedium:t.get("utm_medium")||void 0,C:t.get("utm_campaign")||void 0,utmTerm:t.get("utm_term")||void 0,D:t.get("utm_content")||void 0}}catch(t){return{}}}getElementInfo(t){return{tag:t.tagName?.toLowerCase(),id:t.id,class:t.className,text:this.getElementText(t).substring(0,100)}}getElementText(t){return(t.innerText||t.textContent||t.value||"").trim()}isTrackableElement(t){return["BUTTON","A","INPUT"].includes(t.tagName)||null!==t.getAttribute("data-track-click")||t.classList.contains("track-click")}isDownloadLink(t){return[".pdf",".doc",".docx",".xls",".xlsx",".ppt",".pptx",".zip",".rar",".tar",".gz",".7z",".csv",".txt"].some(e=>t.toLowerCase().includes(e))}getFilename(t){try{return t.split("/").pop().split("?")[0]}catch(t){return"unknown"}}getFileExtension(t){try{const e=this.getFilename(t);return e.includes(".")?e.split(".").pop():"unknown"}catch(t){return"unknown"}}isMobile(){return/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)}getVisitorId(){return this.visitorId}getSessionId(){return this.sessionId}}if(window.morrisb=function(t,e){return window._morrisb_instance&&window._morrisb_instance.workspaceId===t||(window._morrisb_instance=new n(t,e)),window._morrisb_instance},"undefined"!=typeof document){const t=document.currentScript;if(t&&t.dataset&&t.dataset.workspace){const e=t.dataset.config?JSON.parse(t.dataset.config):{};window.morrisb(t.dataset.workspace,e)}}}();